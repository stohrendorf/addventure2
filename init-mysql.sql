CREATE TABLE AuthorName (id INT AUTO_INCREMENT NOT NULL, user_id INT NOT NULL, name VARCHAR(200) NOT NULL, UNIQUE INDEX UNIQ_1D601F9E5E237E06 (name), INDEX userIndex (user_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE Comment (id INT AUTO_INCREMENT NOT NULL, episode_id INT NOT NULL, author_name_id INT DEFAULT NULL, created DATETIME NOT NULL, text LONGTEXT NOT NULL, INDEX commentEpisodeIndex (episode_id), INDEX commentAuthorIndex (author_name_id), UNIQUE INDEX episodeTimestampComment (episode_id, created), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE Episode (id INT AUTO_INCREMENT NOT NULL, parent_id INT DEFAULT NULL, author_id INT DEFAULT NULL, storyline_tag_id INT DEFAULT NULL, title VARCHAR(255) DEFAULT NULL, created DATETIME DEFAULT NULL, postNotes LONGTEXT DEFAULT NULL, preNotes LONGTEXT DEFAULT NULL, text LONGTEXT DEFAULT NULL, hitCount INT NOT NULL, likes INT NOT NULL, dislikes INT NOT NULL, linkable TINYINT(1) NOT NULL, INDEX parentIndex (parent_id), INDEX authorIndex (author_id), INDEX storylineIndex (storyline_tag_id), INDEX createdIndex (created), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE LegacyEpisode (id INT NOT NULL, episode_id INT DEFAULT NULL, rawContent LONGTEXT NOT NULL, UNIQUE INDEX UNIQ_86F254DD362B62A0 (episode_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE Link (isBacklink TINYINT(1) NOT NULL, title VARCHAR(255) NOT NULL, fromEp INT NOT NULL, toEp INT NOT NULL, INDEX fromIndex (fromEp), INDEX toIndex (toEp), PRIMARY KEY(fromEp, toEp)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE Notification (user_id INT NOT NULL, episode_id INT NOT NULL, INDEX notificationUserIndex (user_id), INDEX notificationEpisodeIndex (episode_id), PRIMARY KEY(user_id, episode_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE Report (episode INT NOT NULL, type INT NOT NULL, INDEX IDX_C38372B2DDAA1CDA (episode), PRIMARY KEY(episode, type)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE ci_sessions (session_id VARCHAR(40) NOT NULL, ip_address VARCHAR(45) NOT NULL, user_agent VARCHAR(120) NOT NULL, last_activity INT NOT NULL, user_data LONGTEXT NOT NULL, INDEX last_activity_idx (last_activity), PRIMARY KEY(session_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE SimpleTag (id INT AUTO_INCREMENT NOT NULL, title VARCHAR(200) NOT NULL, UNIQUE INDEX UNIQ_178E47652B36786B (title), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE EpisodeToSimpleTag (simple_tag_id INT NOT NULL, episode_id INT NOT NULL, INDEX IDX_133D11AA2C69D975 (simple_tag_id), INDEX IDX_133D11AA362B62A0 (episode_id), PRIMARY KEY(simple_tag_id, episode_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE StorylineTag (id INT AUTO_INCREMENT NOT NULL, title VARCHAR(200) NOT NULL, UNIQUE INDEX UNIQ_BEFFCF982B36786B (title), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
CREATE TABLE AddventureUsers (id INT AUTO_INCREMENT NOT NULL, email VARCHAR(100) DEFAULT NULL, username VARCHAR(100) DEFAULT NULL, password VARCHAR(255) DEFAULT NULL, role SMALLINT NOT NULL, blocked TINYINT(1) NOT NULL, registeredSince DATETIME DEFAULT NULL, failedLogins SMALLINT NOT NULL, UNIQUE INDEX UNIQ_A3631613E7927C74 (email), UNIQUE INDEX UNIQ_A3631613F85E0677 (username), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB;
ALTER TABLE AuthorName ADD CONSTRAINT FK_1D601F9EA76ED395 FOREIGN KEY (user_id) REFERENCES AddventureUsers (id);
ALTER TABLE Comment ADD CONSTRAINT FK_5BC96BF0362B62A0 FOREIGN KEY (episode_id) REFERENCES Episode (id);
ALTER TABLE Comment ADD CONSTRAINT FK_5BC96BF0342D0395 FOREIGN KEY (author_name_id) REFERENCES AuthorName (id);
ALTER TABLE Episode ADD CONSTRAINT FK_12172546727ACA70 FOREIGN KEY (parent_id) REFERENCES Episode (id);
ALTER TABLE Episode ADD CONSTRAINT FK_12172546F675F31B FOREIGN KEY (author_id) REFERENCES AuthorName (id);
ALTER TABLE Episode ADD CONSTRAINT FK_121725468A2C3E44 FOREIGN KEY (storyline_tag_id) REFERENCES StorylineTag (id);
ALTER TABLE LegacyEpisode ADD CONSTRAINT FK_86F254DD362B62A0 FOREIGN KEY (episode_id) REFERENCES Episode (id);
ALTER TABLE Link ADD CONSTRAINT FK_969E36CF123C8B11 FOREIGN KEY (fromEp) REFERENCES Episode (id);
ALTER TABLE Link ADD CONSTRAINT FK_969E36CF5B99AEB6 FOREIGN KEY (toEp) REFERENCES Episode (id);
ALTER TABLE Notification ADD CONSTRAINT FK_A765AD32A76ED395 FOREIGN KEY (user_id) REFERENCES AddventureUsers (id);
ALTER TABLE Notification ADD CONSTRAINT FK_A765AD32362B62A0 FOREIGN KEY (episode_id) REFERENCES Episode (id);
ALTER TABLE Report ADD CONSTRAINT FK_C38372B2DDAA1CDA FOREIGN KEY (episode) REFERENCES Episode (id);
ALTER TABLE EpisodeToSimpleTag ADD CONSTRAINT FK_133D11AA2C69D975 FOREIGN KEY (simple_tag_id) REFERENCES SimpleTag (id);
ALTER TABLE EpisodeToSimpleTag ADD CONSTRAINT FK_133D11AA362B62A0 FOREIGN KEY (episode_id) REFERENCES Episode (id);
