CREATE TABLE AddventureUsers (id INT NOT NULL, email VARCHAR(100) DEFAULT NULL, username VARCHAR(100) DEFAULT NULL, password VARCHAR(255) DEFAULT NULL, role SMALLINT NOT NULL, blocked BOOLEAN NOT NULL, registeredSince TIMESTAMP(0) WITHOUT TIME ZONE DEFAULT NULL, failedLogins SMALLINT NOT NULL, PRIMARY KEY(id));
CREATE UNIQUE INDEX UNIQ_A3631613E7927C74 ON AddventureUsers (email);
CREATE UNIQUE INDEX UNIQ_A3631613F85E0677 ON AddventureUsers (username);
CREATE TABLE Notification (user_id INT NOT NULL, episode_id INT NOT NULL, PRIMARY KEY(user_id, episode_id));
CREATE INDEX userIndex ON Notification (user_id);
CREATE INDEX episodeIndex ON Notification (episode_id);
CREATE TABLE StorylineTag (id INT NOT NULL, title VARCHAR(200) NOT NULL, PRIMARY KEY(id));
CREATE UNIQUE INDEX UNIQ_BEFFCF982B36786B ON StorylineTag (title);
CREATE TABLE Report (episode INT NOT NULL, type INT NOT NULL, PRIMARY KEY(episode, type));
CREATE INDEX IDX_C38372B2DDAA1CDA ON Report (episode);
CREATE TABLE Comment (id INT NOT NULL, episode_id INT NOT NULL, author_name_id INT DEFAULT NULL, created TIMESTAMP(0) WITHOUT TIME ZONE NOT NULL, text TEXT NOT NULL, PRIMARY KEY(id));
CREATE INDEX episodeIndex ON Comment (episode_id);
CREATE INDEX authorIndex ON Comment (author_name_id);
CREATE UNIQUE INDEX episodeTimestampComment ON Comment (episode_id, created);
CREATE TABLE Link (isBacklink BOOLEAN NOT NULL, title VARCHAR(255) NOT NULL, fromEp INT NOT NULL, toEp INT NOT NULL, PRIMARY KEY(fromEp, toEp));
CREATE INDEX fromIndex ON Link (fromEp);
CREATE INDEX toIndex ON Link (toEp);
CREATE TABLE Episode (id INT NOT NULL, parent_id INT DEFAULT NULL, author_id INT DEFAULT NULL, storyline_tag_id INT DEFAULT NULL, title VARCHAR(255) DEFAULT NULL, created TIMESTAMP(0) WITHOUT TIME ZONE DEFAULT NULL, notes TEXT DEFAULT NULL, preNotes TEXT DEFAULT NULL, text TEXT DEFAULT NULL, hitCount INT NOT NULL, likes INT NOT NULL, dislikes INT NOT NULL, linkable BOOLEAN NOT NULL, PRIMARY KEY(id));
CREATE INDEX parentIndex ON Episode (parent_id);
CREATE INDEX authorIndex ON Episode (author_id);
CREATE INDEX storylineIndex ON Episode (storyline_tag_id);
CREATE INDEX createdIndex ON Episode (created);
CREATE TABLE ci_sessions (session_id VARCHAR(40) NOT NULL, ip_address VARCHAR(45) NOT NULL, user_agent VARCHAR(120) NOT NULL, last_activity INT NOT NULL, user_data TEXT NOT NULL, PRIMARY KEY(session_id));
CREATE INDEX last_activity_idx ON ci_sessions (last_activity);
CREATE TABLE SimpleTag (id INT NOT NULL, title VARCHAR(200) NOT NULL, PRIMARY KEY(id));
CREATE UNIQUE INDEX UNIQ_178E47652B36786B ON SimpleTag (title);
CREATE TABLE EpisodeToSimpleTag (simple_tag_id INT NOT NULL, episode_id INT NOT NULL, PRIMARY KEY(simple_tag_id, episode_id));
CREATE INDEX IDX_133D11AA2C69D975 ON EpisodeToSimpleTag (simple_tag_id);
CREATE INDEX IDX_133D11AA362B62A0 ON EpisodeToSimpleTag (episode_id);
CREATE TABLE AuthorName (id INT NOT NULL, user_id INT NOT NULL, name VARCHAR(200) NOT NULL, PRIMARY KEY(id));
CREATE UNIQUE INDEX UNIQ_1D601F9E5E237E06 ON AuthorName (name);
CREATE INDEX userIndex ON AuthorName (user_id);
CREATE TABLE LegacyEpisode (id INT NOT NULL, episode_id INT DEFAULT NULL, rawContent TEXT NOT NULL, PRIMARY KEY(id));
CREATE UNIQUE INDEX UNIQ_86F254DD362B62A0 ON LegacyEpisode (episode_id);
CREATE SEQUENCE AddventureUsers_id_seq INCREMENT BY 1 MINVALUE 1 START 1;
CREATE SEQUENCE StorylineTag_id_seq INCREMENT BY 1 MINVALUE 1 START 1;
CREATE SEQUENCE Comment_id_seq INCREMENT BY 1 MINVALUE 1 START 1;
CREATE SEQUENCE Episode_id_seq INCREMENT BY 1 MINVALUE 1 START 1;
CREATE SEQUENCE SimpleTag_id_seq INCREMENT BY 1 MINVALUE 1 START 1;
CREATE SEQUENCE AuthorName_id_seq INCREMENT BY 1 MINVALUE 1 START 1;
ALTER TABLE Notification ADD CONSTRAINT FK_A765AD32A76ED395 FOREIGN KEY (user_id) REFERENCES AddventureUsers (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE Notification ADD CONSTRAINT FK_A765AD32362B62A0 FOREIGN KEY (episode_id) REFERENCES Episode (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE Report ADD CONSTRAINT FK_C38372B2DDAA1CDA FOREIGN KEY (episode) REFERENCES Episode (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE Comment ADD CONSTRAINT FK_5BC96BF0362B62A0 FOREIGN KEY (episode_id) REFERENCES Episode (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE Comment ADD CONSTRAINT FK_5BC96BF0342D0395 FOREIGN KEY (author_name_id) REFERENCES AuthorName (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE Link ADD CONSTRAINT FK_969E36CF123C8B11 FOREIGN KEY (fromEp) REFERENCES Episode (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE Link ADD CONSTRAINT FK_969E36CF5B99AEB6 FOREIGN KEY (toEp) REFERENCES Episode (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE Episode ADD CONSTRAINT FK_12172546727ACA70 FOREIGN KEY (parent_id) REFERENCES Episode (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE Episode ADD CONSTRAINT FK_12172546F675F31B FOREIGN KEY (author_id) REFERENCES AuthorName (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE Episode ADD CONSTRAINT FK_121725468A2C3E44 FOREIGN KEY (storyline_tag_id) REFERENCES StorylineTag (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE EpisodeToSimpleTag ADD CONSTRAINT FK_133D11AA2C69D975 FOREIGN KEY (simple_tag_id) REFERENCES SimpleTag (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE EpisodeToSimpleTag ADD CONSTRAINT FK_133D11AA362B62A0 FOREIGN KEY (episode_id) REFERENCES Episode (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE AuthorName ADD CONSTRAINT FK_1D601F9EA76ED395 FOREIGN KEY (user_id) REFERENCES AddventureUsers (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE LegacyEpisode ADD CONSTRAINT FK_86F254DD362B62A0 FOREIGN KEY (episode_id) REFERENCES Episode (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
